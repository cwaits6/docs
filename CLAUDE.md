# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

A documentation site for HomeLab DevOps projects, built with [Fumadocs](https://fumadocs.dev/) on Next.js. Content is authored in an Obsidian vault and generated into MDX files. The site is statically exported and hosted on AWS (S3 + CloudFront).

## Commands

```bash
pnpm install          # Install dependencies (runs fumadocs-mdx postinstall)
pnpm dev              # Dev server at localhost:3000
pnpm build            # Static export to out/
pnpm start            # Serve out/ locally via serve
pnpm lint             # ESLint
pnpm run types:check  # Full type check: fumadocs-mdx → next typegen → tsc --noEmit
```

Content generation from Obsidian vault (requires `OBSIDIAN_PUBLISH_DIR` in `.env.local`):
```bash
npx tsx scripts/generate.ts
```

No test framework is configured.

## Architecture

**Content pipeline:** Obsidian vault → `scripts/generate.ts` (fumadocs-obsidian) → MDX in `content/` → Next.js static build → `out/` directory → S3/CloudFront

**Key directories:**
- `app/` — Next.js App Router. `[[...slug]]/page.tsx` is the catch-all route for all doc pages.
- `content/` — MDX documentation files with frontmatter (`title`, `description`).
- `components/` — React components (provider wrapper, Orama search dialog).
- `lib/` — Fumadocs source loader (`source.ts`) and shared layout config (`layout.shared.tsx`).
- `.source/` — Auto-generated by fumadocs-mdx (gitignored, regenerated on install/build).
- `infra/site.yaml` — CloudFormation template: S3 bucket, CloudFront distribution, Route53 DNS, ACM cert, www→apex redirect function.
- `scripts/generate.ts` — Reads Obsidian vault and outputs MDX + assets.

**Special routes:**
- `/api/search` — Orama full-text search index (static)
- `/og/[...slug]` — Dynamic Open Graph image generation
- `/llms-full.txt` — All docs as plain text for LLM consumption

## Tech Stack

- **Next.js 16** with App Router, static export (`output: 'export'`)
- **Fumadocs** (core, UI, MDX, obsidian plugin) for documentation framework
- **Tailwind CSS 4** for styling
- **Orama** for client-side search
- **pnpm** as package manager
- **TypeScript** with strict mode

## Infrastructure

The CloudFormation stack in `infra/site.yaml` provisions:
- Private S3 bucket with CloudFront Origin Access Control
- CloudFront distribution with custom domain and ACM certificate
- Route53 A/AAAA records for apex and www subdomains
- CloudFront Function for www→apex redirect

Parameters: `SiteDomain`, `WwwDomain`, `HostedZoneId`, `AcmCertArn` (must be us-east-1).
